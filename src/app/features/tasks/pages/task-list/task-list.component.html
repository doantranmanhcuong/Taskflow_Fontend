<app-navbar></app-navbar>

<div class="task-container">
  <div class="header">
    <h2>C√¥ng vi·ªác c·ªßa b·∫°n</h2>
    <button mat-raised-button color="primary" routerLink="/tasks/create" class="primary-btn">+ T·∫°o task</button>
  </div>

  <mat-spinner diameter="50" *ngIf="loading" class="loading-spinner"></mat-spinner>

  <!-- SECTION: TODO -->
  <h3>C·∫ßn l√†m</h3>
  <div class="task-list" *ngIf="!loading && todo.length > 0">
    <mat-card class="task-card" *ngFor="let t of todo" appearance="outlined">
      <mat-card-content>
        <div class="task-content">
          <mat-checkbox 
            (change)="toggleTaskStatus(t)">
          </mat-checkbox>
          <div class="task-details">
            <h4>{{ t.title }}</h4>
            <p *ngIf="t.description">{{ t.description }}</p>
            <div class="meta">
              <span *ngIf="t.priority" class="priority-badge priority-{{ t.priority }}">
                {{ t.priority | titlecase }}
              </span>
              
              <!-- ‚úÖ TH√äM HI·ªÇN TH·ªä NG√ÄY + GI·ªú -->
              <small class="due-date">
                üìÖ 
                <span *ngIf="t.date">{{ t.date | date: 'dd/MM/yyyy' }}</span>
                <span *ngIf="!t.date && t.createdAt">{{ t.createdAt | date: 'dd/MM/yyyy' }}</span>
                
                <!-- Hi·ªÉn th·ªã gi·ªù n·∫øu c√≥ -->
                <span *ngIf="t.time" style="margin-left: 8px;">
                  ‚è∞ {{ t.time | slice:0:5 }}
                </span>
              </small>
            </div>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <a mat-button [routerLink]="['/tasks', t.id, 'edit']" class="edit-btn">S·ª≠a</a>
        <button mat-icon-button (click)="deleteTask(t)" class="delete-btn" matTooltip="X√≥a">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
  <div *ngIf="!loading && todo.length === 0" class="empty-state">
    <p>Kh√¥ng c√≥ c√¥ng vi·ªác n√†o c·∫ßn l√†m</p>
  </div>

  <!-- SECTION: DONE -->
  <h3>ƒê√£ ho√†n th√†nh</h3>
  <div class="task-list" *ngIf="!loading && done.length > 0">
    <mat-card class="task-card done" *ngFor="let t of done" appearance="outlined">
      <mat-card-content>
        <div class="task-content">
          <mat-checkbox 
            (change)="toggleTaskStatus(t)" 
            [checked]="true">
            Ho√†n th√†nh
          </mat-checkbox>
          <div class="task-details">
            <h4 class="completed-title">{{ t.title }}</h4>
            <p *ngIf="t.description" class="completed-description">{{ t.description }}</p>
            <div class="meta">
              <span *ngIf="t.priority" class="priority-badge priority-{{ t.priority }}">
                {{ t.priority | titlecase }}
              </span>
              
              <!-- ‚úÖ HI·ªÇN TH·ªä TH·ªúI GIAN HO√ÄN TH√ÄNH -->
              <small *ngIf="t.completedAt" class="completed-date">
                ‚úÖ Ho√†n th√†nh: {{ t.completedAt | date: 'dd/MM/yyyy HH:mm' }}
              </small>
              
              <!-- ‚úÖ HI·ªÇN TH·ªä TH·ªúI GIAN D·ª∞ KI·∫æN (n·∫øu c√≥) -->
              <small *ngIf="t.date || t.time" class="original-due">
                üìÖ 
                <span *ngIf="t.date">{{ t.date | date: 'dd/MM/yyyy' }}</span>
                <span *ngIf="t.time"> - ‚è∞ {{ t.time | slice:0:5 }}</span>
              </small>
            </div>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <a mat-button [routerLink]="['/tasks', t.id, 'edit']" class="edit-btn">S·ª≠a</a>
        <button mat-icon-button (click)="deleteTask(t)" class="delete-btn" matTooltip="X√≥a">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
  <div *ngIf="!loading && done.length === 0" class="empty-state">
    <p>Ch∆∞a c√≥ c√¥ng vi·ªác n√†o ho√†n th√†nh</p>
  </div>
</div>